var J=Object.defineProperty,K=(i,t,e)=>t in i?J(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,_=(i,t,e)=>(K(i,typeof t!="symbol"?t+"":t,e),e);class Q{constructor({el:t,options:e}){_(this,"el"),_(this,"options"),_(this,"directionArr"),_(this,"timer"),_(this,"scrollWrapper"),_(this,"resizeObserverCtx"),t instanceof HTMLElement?this.el=t:this.el=document.querySelector(t),this.options={direction:"y",scrollBarWidth:6,scrollBarOffsetX:0,scrollBarOffsetY:0,scrollBarThumbColor:"#aab",scrollBarThumbBorderRadius:!0,scrollBarTrackColor:"transparent",enableTrackClickScroll:!0,scrollSpeed:20,dragScroll:!1,thumbShow:"always",observeAutoUpdate:!0,...e},this.directionArr=this.options.direction==="all"?["x","y"]:["x","y"].includes(this.options.direction)?[this.options.direction]:["y"],this.timer=null,this.el.$scroll=this}init(t=0,e=0){this.scrollWrapper=document.createElement("div"),this.scrollWrapper.style.cssText=`position: absolute;top:0;left:0;bottom:0;right:0;transform:translate(${t}px,${e}px)`,this.scrollWrapper.setAttribute("class","scroll__wrapper"),this.el.appendChild(this.scrollWrapper),this.el.style.position="relative",this.el.style.overflow="hidden",this.directionArr.map(o=>{this.createScrollBarTrack(o)}),this.options.dragScroll&&this.setDragScroll(this.el,this.directionArr),this.options.thumbShow==="hover"&&this.setDisplayForHover(this.el),this.options.observeAutoUpdate&&this.addObserveForAutoUpdate(this.el)}createScrollBarTrack(t){const e=t==="y";let{scrollBarWidth:o,scrollBarOffsetX:s,scrollBarOffsetY:p,scrollBarThumbColor:c,scrollBarThumbHoverColor:a,scrollBarThumbBorderRadius:b,scrollBarTrackColor:y,enableTrackClickScroll:F,scrollSpeed:k}=this.options;const E=c.includes("gradient");b=b?o/2:0;const m=document.createElement("div");m.setAttribute("direction",t);const P=e?`position: absolute;right: 0;top: 0;height: 100%; width: ${o+s*2}px;background: ${y};`:`position: absolute;left: 0;bottom: 0;width: 100%; height: ${o+s*2}px;background: ${y};`;m.style.cssText=P,m.setAttribute("class",`scroll__track_${t}`),this.scrollWrapper&&this.scrollWrapper.appendChild(m);const f=document.createElement("div");let Y=e?`position: relative;top: 0;right: 0;width: ${o+s*2}px;padding: ${p}px ${s}px;box-sizing:border-box;cursor: pointer;`:`position: relative;bottom: 0;left: 0;height: ${o+s*2}px;padding: ${s}px ${p}px;box-sizing:border-box;cursor: pointer;`;const $=document.createElement("div");let C=`width: 100%;height:100%;border-radius: ${b}px;`;E?C+=`background-image: ${c};`:C+=`background: ${c};`;const{offsetHeight:v,scrollHeight:g,offsetWidth:w,scrollWidth:B,scrollTop:R,scrollLeft:I}=this.el,h=e?v:w,x=e?g:B;if(x<=h)return;const O=h/x*h;Y+=e?`height: ${O}px;`:`width: ${O}px`,f.style.cssText=Y,f.setAttribute("class","scroll__thumb"),$.style.cssText=C,$.setAttribute("class","scroll__thumb_inner"),f.appendChild($),m.appendChild(f);let l=e?R:I;const D=l/x*h;f.style.transform=e?`translateY(${D}px)`:`translateX(${D}px)`;let H=!1;const A=x-h,T=h-O;e&&(this.el.onmousewheel=function(u){const r=-u.wheelDelta||u.deltaY;return H||(l=r<0?l<-r?0:l+r:l>=A-r?A:l+r,q(m,l/x*h)),!1}),a&&(f.onmouseenter=function(){a&&($.style.background=a)},f.onmouseleave=function(){$.style.background=c}),f.onmousedown=function(u){u.stopPropagation();const r=u.target.parentNode,S=e?u.clientY:u.clientX,[d]=r.style.transform.match(/\d+(\.\d+)?/)||[0],n=~~d;H=!0,document.onmousemove=function(N){document.body.style.userSelect="none";const{clientY:U,clientX:G}=N;let L=(e?U:G)-S+n;l=L/h*x,l<0?(L=0,l=0):l>A&&(L=T,l=A),q(m,L)},document.onmouseup=function(){H=!1,document.body.style.userSelect="auto",document.onmousemove=null,document.onmouseup=null}},F&&(m.onmousedown=function(u){const r=u.target;if(r){let d=(e?u.clientY-r.getBoundingClientRect().top:u.clientX-r.getBoundingClientRect().left)-O/2;d<0?d=0:d>T&&(d=T),q(r,d)}});let M,W;const q=(u,r)=>{W&&window.cancelAnimationFrame(W),M=()=>{let S,d,[n]=u.childNodes[0].style.transform.match(/\d+(\.\d+)?/)||[0];n=~~n,r>n?(n+=k,n<r?(l=n/h*x,S=n,d=!1):(l=n>T?A:r/h*x,S=n>T?T:r,d=!0)):(n-=k,n>r?(l=n/h*x,S=n,d=!1):(l=n<0?0:r/h*x,S=n<0?0:r,d=!0)),this.setTranslate(t,l),f.style.transform=e?`translateY(${S}px)`:`translateX(${S}px)`,e?this.el.scrollTop=l:this.el.scrollLeft=l,d?window.cancelAnimationFrame(W):W=window.requestAnimationFrame(M)},W=window.requestAnimationFrame(M)}}update(t=200){this.timer!==null&&clearTimeout(this.timer),this.timer=setTimeout(()=>{if(this.scrollWrapper){console.log("update scroll");const{transform:e}=window.getComputedStyle(this.scrollWrapper),[,,,,o,s]=e.match(/-?\d+\.?\d{0,}/g),p=~~o,c=~~s;this.destroy(),this.init(p,c)}},t)}destroy(){var t;this.scrollWrapper&&((t=this.scrollWrapper.parentNode)==null||t.removeChild(this.scrollWrapper),this.scrollWrapper=null),this.el.mouseenterEvent&&this.el.addEventListener("mouseenter",this.el.mouseenterEvent),this.el.mouseleaveEvent&&this.el.addEventListener("mouseleave",this.el.mouseleaveEvent),this.resizeObserverCtx&&this.resizeObserverCtx.unobserve(this.el)}setTranslate(t,e){if(this.scrollWrapper){const{transform:o}=window.getComputedStyle(this.scrollWrapper),[s,p,c,a,b,y]=o.match(/-?\d+\.?\d{0,}/g);t==="x"?this.scrollWrapper.style.transform=`matrix(${s},${p},${c},${a},${e},${y})`:t==="y"&&(this.scrollWrapper.style.transform=`matrix(${s},${p},${c},${a},${b},${e})`)}}setDisplayForHover(t){const e="opacity: 0;transition: opacity .4s ease-in-out",o=Array.from(t.querySelectorAll(".scroll__thumb"));o.map(s=>{s.style.cssText=s.style.cssText+e}),t.mouseenterEvent=function(){o.map(s=>{s.style.opacity="1"})},t.mouseleaveEvent=function(){o.map(s=>{s.style.opacity="0"})},t.addEventListener("mouseenter",t.mouseenterEvent),t.addEventListener("mouseleave",t.mouseleaveEvent)}setDragScroll(t,e){t.onmousedown=function(o){const{scrollTop:s,scrollLeft:p,scrollHeight:c,offsetHeight:a,scrollWidth:b,offsetWidth:y}=t,{clientX:F,clientY:k}=o,[E,m]=[b-y,c-a],[P,f]=[y-y/b*y,a-a/c*a];document.body.style.userSelect="none",document.body.style.cursor="pointer",document.onmousemove=function(Y){const{clientX:$,clientY:C}=Y;let[v,g]=[F-$+p,k-C+s],[w,B]=[v/b*y,g/c*a];v<0?(w=0,v=0):v>E&&(w=P,v=E),g<0?(B=0,g=0):g>m&&(B=f,g=m),t.querySelector(".scroll__wrapper").style.transform=`translate(${v}px, ${g}px)`,e.includes("x")&&(t.querySelector(".scroll__track_x .scroll__thumb").style.transform=`translateX(${w}px)`),e.includes("y")&&(t.querySelector(".scroll__track_y .scroll__thumb").style.transform=`translateY(${B}px)`),t.scrollTop=g,t.scrollLeft=v},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,document.body.style.userSelect="default",document.body.style.cursor="default"}}}addObserveForAutoUpdate(t){let e=!1;const o=s=>{if(!e){e=!0;return}this.update()};this.resizeObserverCtx=new ResizeObserver(o),this.resizeObserverCtx.observe(t)}}const X=(i,t,e)=>{const{arg:o,value:s}=t,p=/(Android|iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent),c=e||{};if(!p){const a={...c,...s,direction:o};new Q({el:i,options:a}).init()}},z=i=>{i.$scroll&&i.$scroll.destroy()},V={mounted:(i,t)=>X(i,t),unmounted:z,inserted:(i,t)=>X(i,t),unbind:z,install:(i,t)=>{i.directive("scroll",{mounted:(e,o)=>X(e,o,t),unmounted:z,inserted:(e,o)=>X(e,o,t),unbind:z})}};export{V as S};
