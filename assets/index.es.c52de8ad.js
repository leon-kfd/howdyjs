import{_ as t}from"./tslib.es6.d5acbd82.js";var i=function(){function i(i){var e=i.el,s=i.options;this.left=0,this.top=0,this.startX=0,this.startY=0,this.width=0,this.height=0,this.maxX=0,this.maxY=0,this.getScrollbarWidth=function(){var t=document.createElement("div");t.style.cssText="width:100px;height:100px;overflow-y:scroll",document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i},this.setBetween=function(t,i,e){return t<i?i:t>e?e:t},this.el=e instanceof HTMLElement?e:document.querySelector(e),this.scrollbarWidth=this.getScrollbarWidth(),this.isTouch="ontouchstart"in document.documentElement,this.isDrag=!1,this.options=t({moveCursor:!0,adsorb:0,adsorbOffset:0,transitionDuration:400,transitionTimingFunction:"ease-in-out",forbidBodyScroll:!0,isAbsolute:!1},s),this.parent=this.options.parentSelector&&document.querySelector(this.options.parentSelector)||this.el.parentNode,this.options.transitionDuration&&(this.options.transitionDuration=this.options.transitionDuration/1e3),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleMousedown=this.handleMousedown.bind(this),this.moveEvent=this.moveEvent.bind(this),this.endEvent=this.endEvent.bind(this),this.init()}return i.prototype.init=function(){var t=this;this.isTouch?this.el.addEventListener("touchstart",this.handleTouchStart):this.el.addEventListener("mousedown",this.handleMousedown),this.options.moveCursor&&(this.el.style.cursor="move"),this.setPosition(),!this.options.isAbsolute&&this.options.adsorb&&this.handleAdsorb(),setTimeout((function(){t.emitEvent("todraginit")}))},i.prototype.handleMousedown=function(t){var i=t.x,e=t.y;this.setStartInfo(i,e),document.addEventListener("mousemove",this.moveEvent),document.addEventListener("mouseup",this.endEvent)},i.prototype.handleTouchStart=function(t){var i=this.isTouch?t.changedTouches[0].clientX:t.x,e=this.isTouch?t.changedTouches[0].clientY:t.y;this.setStartInfo(i,e),document.addEventListener("touchmove",this.moveEvent,{passive:!1}),document.addEventListener("touchend",this.endEvent)},i.prototype.setPosition=function(){var t=this.el.getBoundingClientRect(),i=t.left,e=t.top,s=t.width,o=t.height;this.left=i,this.top=e,this.width=s,this.height=o,this.options.isAbsolute?(this.maxX=this.parent.offsetWidth-this.width,this.maxY=this.parent.offsetHeight-this.height):(this.maxX=document.body.scrollWidth>window.innerWidth?window.innerWidth-this.width-this.scrollbarWidth:window.innerWidth-this.width,this.maxY=document.body.scrollHeight>window.innerHeight?window.innerHeight-this.height-this.scrollbarWidth:window.innerHeight-this.height)},i.prototype.setStartInfo=function(t,i){this.setPosition(),this.startX=t-this.left,this.startY=i-this.top,this.isDrag=!0,this.el.style.transition="",document.body.style.userSelect="none",this.options.forbidBodyScroll&&(document.body.style.overflow="hidden"),this.emitEvent("todragstart")},i.prototype.moveEvent=function(t){if(this.isDrag){var i,e;t.preventDefault();var s=this.isTouch?t.changedTouches[0].clientX:t.x,o=this.isTouch?t.changedTouches[0].clientY:t.y;if(this.options.isAbsolute){var n=this.parent.getClientRects()[0];i=s-n.x-this.startX,e=o-n.y-this.startY}else i=s-this.startX,e=o-this.startY;this.left=this.setBetween(i,0,this.maxX),this.top=this.setBetween(e,0,this.maxY),this.el.style.left=this.left+"px",this.el.style.top=this.top+"px",this.emitEvent("todragmove")}},i.prototype.endEvent=function(){this.isDrag=!1,document.removeEventListener("mousemove",this.moveEvent),document.removeEventListener("mouseup",this.endEvent),document.removeEventListener("touchmove",this.moveEvent),document.removeEventListener("touchend",this.endEvent),document.body.style.userSelect="auto",this.options.forbidBodyScroll&&(document.body.style.overflow="visible"),this.handleAdsorb(),this.emitEvent("todragend")},i.prototype.handleAdsorb=function(){if(!this.options.isAbsolute){var t=[this.left+this.width/2,this.top+this.height/2],i=[window.innerWidth,window.innerHeight];if(this.el.style.transition="left "+this.options.transitionDuration+"s "+this.options.transitionTimingFunction+", \n                                top "+this.options.transitionDuration+"s "+this.options.transitionTimingFunction,1===this.options.adsorb)t[0]<=window.innerWidth/2?this.left=this.options.adsorbOffset:this.left=this.maxX-this.options.adsorbOffset;else if(2===this.options.adsorb){var e=i[1]/i[0],s=i[1]/-i[0],o=t[1]/t[0],n=t[1]/(t[0]-i[0]);e>=o&&s<n?this.top=this.options.adsorbOffset:e>=o&&s>=n?this.left=this.maxX-this.options.adsorbOffset:e<o&&s>=n?this.top=this.maxY-this.options.adsorbOffset:this.left=this.options.adsorbOffset,this.options.adsorbOffset&&(0===this.top&&(this.top=this.options.adsorbOffset),this.top===this.maxY&&(this.top=this.maxY-this.options.adsorbOffset),0===this.left&&(this.left=this.options.adsorbOffset),this.left===this.maxX&&(this.left=this.maxX-this.options.adsorbOffset))}this.el.style.left=this.left+"px",this.el.style.top=this.top+"px"}},i.prototype.emitEvent=function(t){var i=document.createEvent("HTMLEvents");i.initEvent(t,!1,!1);var e=this,s=e.left,o=e.top,n=e.width,h=e.height,r=e.maxX,d=e.maxY;i.left=s,i.top=o,i.width=n,i.height=h,i.maxX=r,i.maxY=d,this.el.dispatchEvent(i)},i.prototype.destroy=function(){this.isTouch?this.el.removeEventListener("touchstart",this.handleTouchStart):this.el.removeEventListener("mousedown",this.handleMousedown)},i}(),e=function(e,s,o){var n=s.value,h=t(t({},o||{}),n);e.$toDarg=new i({el:e,options:h})},s=function(t){t.$toDarg&&t.$toDarg.destroy()},o={install:function(t,i){t.directive("to-drag",{mounted:function(t,s){return e(t,s,i)},unmounted:s,inserted:function(t,s){return e(t,s,i)},unbind:s})},mounted:function(t,i){return e(t,i)},unmounted:s,inserted:function(t,i){return e(t,i)},unbind:s};export{o as T};
