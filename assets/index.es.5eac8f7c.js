class t{constructor({el:t,options:i}){this.left=0,this.top=0,this.right=0,this.bottom=0,this.width=0,this.height=0,this.maxX=0,this.maxY=0,this.startX=0,this.startY=0,this.getScrollbarWidth=()=>{const t=document.createElement("div");t.style.cssText="width:100px;height:100px;overflow-y:scroll",document.body.appendChild(t);const i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i},this.setBetween=(t,i,s)=>t<i?i:t>s?s:t,this.borderInfo=[0,0,0,0],this.el=t instanceof HTMLElement?t:document.querySelector(t),this.scrollbarWidth=this.getScrollbarWidth(),this.isTouch="ontouchstart"in document.documentElement,this.isDrag=!1,this.options=Object.assign({moveCursor:!0,adsorb:0,adsorbOffset:0,transitionDuration:400,transitionTimingFunction:"ease-in-out",forbidBodyScroll:!0,isAbsolute:!1,positionMode:1,needComputeBorder:!0},i),this.parent=this.options.parentSelector&&document.querySelector(this.options.parentSelector)||this.el.parentNode,this.options.transitionDuration&&(this.options.transitionDuration=this.options.transitionDuration/1e3),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleMousedown=this.handleMousedown.bind(this),this.moveEvent=this.moveEvent.bind(this),this.endEvent=this.endEvent.bind(this),this.init()}init(){this.isTouch?this.el.addEventListener("touchstart",this.handleTouchStart):this.el.addEventListener("mousedown",this.handleMousedown),this.options.moveCursor&&(this.el.style.cursor="move"),this.setPosition(),this.setLimit(),this.handleAdsorb(),this.handlePositionMode(),setTimeout((()=>{this.emitEvent("todraginit")}))}handleMousedown(t){if("function"==typeof this.options.disabled&&this.options.disabled())return;const{x:i,y:s}=t;this.setStartInfo(i,s),document.addEventListener("mousemove",this.moveEvent),document.addEventListener("mouseup",this.endEvent)}handleTouchStart(t){if("function"==typeof this.options.disabled&&this.options.disabled())return;const i=this.isTouch?t.changedTouches[0].clientX:t.x,s=this.isTouch?t.changedTouches[0].clientY:t.y;this.setStartInfo(i,s),document.addEventListener("touchmove",this.moveEvent,{passive:!1}),document.addEventListener("touchend",this.endEvent)}setPosition(){const{left:t,top:i,width:s,height:e}=this.el.getBoundingClientRect();this.left=t,this.top=i,this.width=s,this.height=e,this.options.isAbsolute?(this.maxX=this.parent.offsetWidth-this.width,this.maxY=this.parent.offsetHeight-this.height):(this.maxX=document.body.scrollWidth>window.innerWidth?window.innerWidth-this.width-this.scrollbarWidth:window.innerWidth-this.width,this.maxY=document.body.scrollHeight>window.innerHeight?window.innerHeight-this.height-this.scrollbarWidth:window.innerHeight-this.height)}setStartInfo(t,i){this.setPosition(),this.setLimit(),this.startX=t-this.left,this.startY=i-this.top,this.isDrag=!0,this.el.style.transition="",document.body.style.userSelect="none",this.options.forbidBodyScroll&&(document.body.style.overflow="hidden"),this.emitEvent("todragstart")}moveEvent(t){if(!this.isDrag)return;let i,s;t.preventDefault();const e=this.isTouch?t.changedTouches[0].clientX:t.x,o=this.isTouch?t.changedTouches[0].clientY:t.y;if(this.options.isAbsolute){const t=this.parent.getClientRects()[0];i=e-t.x-this.startX-this.borderInfo[1],s=o-t.y-this.startY-this.borderInfo[2]}else i=e-this.startX,s=o-this.startY;this.left=this.setBetween(i,0,this.maxX-this.borderInfo[1]-this.borderInfo[3]),this.top=this.setBetween(s,0,this.maxY-this.borderInfo[2]-this.borderInfo[0]),this.el.style.left=this.left+"px",this.el.style.top=this.top+"px",this.emitEvent("todragmove")}endEvent(){this.isDrag=!1,document.removeEventListener("mousemove",this.moveEvent),document.removeEventListener("mouseup",this.endEvent),document.removeEventListener("touchmove",this.moveEvent),document.removeEventListener("touchend",this.endEvent),document.body.style.userSelect="auto",this.options.forbidBodyScroll&&(document.body.style.overflow="visible"),this.handleAdsorb(),this.handlePositionMode(),this.emitEvent("todragend")}handleAdsorb(){if(this.options.isAbsolute)return;const t=[this.left+this.width/2,this.top+this.height/2],i=[window.innerWidth,window.innerHeight];if(this.el.style.transition=`left ${this.options.transitionDuration}s ${this.options.transitionTimingFunction}, \n                                top ${this.options.transitionDuration}s ${this.options.transitionTimingFunction}`,1===this.options.adsorb)t[0]<=window.innerWidth/2?this.left=this.options.adsorbOffset:this.left=this.maxX-this.options.adsorbOffset;else if(2===this.options.adsorb){const s=i[1]/i[0],e=i[1]/-i[0],o=t[1]/t[0],n=t[1]/(t[0]-i[0]);s>=o&&e<n?this.top=this.options.adsorbOffset:s>=o&&e>=n?this.left=this.maxX-this.options.adsorbOffset:s<o&&e>=n?this.top=this.maxY-this.options.adsorbOffset:this.left=this.options.adsorbOffset,this.options.adsorbOffset&&(0===this.top&&(this.top=this.options.adsorbOffset),this.top===this.maxY&&(this.top=this.maxY-this.options.adsorbOffset),0===this.left&&(this.left=this.options.adsorbOffset),this.left===this.maxX&&(this.left=this.maxX-this.options.adsorbOffset))}this.el.style.left=this.left+"px",this.el.style.top=this.top+"px"}handlePositionMode(){if(this.options.adsorb)return;const t=this.options.isAbsolute?this.el.offsetLeft:this.left,i=this.options.isAbsolute?this.el.offsetTop:this.top;this.right=this.maxX-t-this.borderInfo[1]-this.borderInfo[3],this.bottom=this.maxY-i-this.borderInfo[2]-this.borderInfo[0],2===this.options.positionMode?(this.el.style.left="auto",this.el.style.right=this.right+"px"):3===this.options.positionMode?(this.el.style.top="auto",this.el.style.bottom=this.bottom+"px"):4===this.options.positionMode&&(this.el.style.left="auto",this.el.style.top="auto",this.el.style.right=this.right+"px",this.el.style.bottom=this.bottom+"px")}emitEvent(t){const i=document.createEvent("HTMLEvents");i.initEvent(t,!1,!1);const{left:s,top:e,right:o,bottom:n,width:h,height:r,maxX:d,maxY:a}=this;i.left=s,i.top=e,i.width=h,i.height=r,i.maxX=d,i.maxY=a,i.right=o,i.bottom=n,this.el.dispatchEvent(i)}destroy(){this.isTouch?this.el.removeEventListener("touchstart",this.handleTouchStart):this.el.removeEventListener("mousedown",this.handleMousedown)}setLimit(){if(!this.options.isAbsolute||!this.options.needComputeBorder)return;const t=["top","right","bottom","left"],i=function(t,i,s=!1){const e={},o=window.getComputedStyle(t);return i.map((t=>{let i=o[t];if(s){const t=i.match(/\d+/);t&&(i=~~t[0])}e[t]=i})),e}(this.parent,[...t.map((t=>`border-${t}-width`))],!0);this.borderInfo=t.map((t=>i[`border-${t}-width`]))}}const i=(i,s,e)=>{const{value:o}=s,n=e||{},h=Object.assign(Object.assign({},n),o);i.$toDarg=new t({el:i,options:h})},s=t=>{t.$toDarg&&t.$toDarg.destroy()},e={mounted:(t,s)=>i(t,s),unmounted:s,inserted:(t,s)=>i(t,s),unbind:s,install:(t,e)=>{t.directive("to-drag",{mounted:(t,s)=>i(t,s,e),unmounted:s,inserted:(t,s)=>i(t,s,e),unbind:s})}};export{t as T,e as a};
