import{_ as t}from"./tslib.es6.3b1b0bea.js";var i=function(){function i(i){var s=i.el,e=i.options;this.left=0,this.top=0,this.right=0,this.bottom=0,this.startX=0,this.startY=0,this.width=0,this.height=0,this.maxX=0,this.maxY=0,this.getScrollbarWidth=function(){var t=document.createElement("div");t.style.cssText="width:100px;height:100px;overflow-y:scroll",document.body.appendChild(t);var i=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),i},this.setBetween=function(t,i,s){return t<i?i:t>s?s:t},this.el=s instanceof HTMLElement?s:document.querySelector(s),this.scrollbarWidth=this.getScrollbarWidth(),this.isTouch="ontouchstart"in document.documentElement,this.isDrag=!1,this.options=t({moveCursor:!0,adsorb:0,adsorbOffset:0,transitionDuration:400,transitionTimingFunction:"ease-in-out",forbidBodyScroll:!0,isAbsolute:!1,positionMode:1},e),this.parent=this.options.parentSelector&&document.querySelector(this.options.parentSelector)||this.el.parentNode,this.options.transitionDuration&&(this.options.transitionDuration=this.options.transitionDuration/1e3),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleMousedown=this.handleMousedown.bind(this),this.moveEvent=this.moveEvent.bind(this),this.endEvent=this.endEvent.bind(this),this.init()}return i.prototype.init=function(){var t=this;this.isTouch?this.el.addEventListener("touchstart",this.handleTouchStart):this.el.addEventListener("mousedown",this.handleMousedown),this.options.moveCursor&&(this.el.style.cursor="move"),this.setPosition(),this.handleAdsorb(),this.handlePositionMode(),setTimeout((function(){t.emitEvent("todraginit")}))},i.prototype.handleMousedown=function(t){if("function"!=typeof this.options.disabled||!this.options.disabled()){var i=t.x,s=t.y;this.setStartInfo(i,s),document.addEventListener("mousemove",this.moveEvent),document.addEventListener("mouseup",this.endEvent)}},i.prototype.handleTouchStart=function(t){if("function"!=typeof this.options.disabled||!this.options.disabled()){var i=this.isTouch?t.changedTouches[0].clientX:t.x,s=this.isTouch?t.changedTouches[0].clientY:t.y;this.setStartInfo(i,s),document.addEventListener("touchmove",this.moveEvent,{passive:!1}),document.addEventListener("touchend",this.endEvent)}},i.prototype.setPosition=function(){var t=this.el.getBoundingClientRect(),i=t.left,s=t.top,e=t.width,o=t.height;this.left=i,this.top=s,this.width=e,this.height=o,this.options.isAbsolute?(this.maxX=this.parent.offsetWidth-this.width,this.maxY=this.parent.offsetHeight-this.height):(this.maxX=document.body.scrollWidth>window.innerWidth?window.innerWidth-this.width-this.scrollbarWidth:window.innerWidth-this.width,this.maxY=document.body.scrollHeight>window.innerHeight?window.innerHeight-this.height-this.scrollbarWidth:window.innerHeight-this.height)},i.prototype.setStartInfo=function(t,i){this.setPosition(),this.startX=t-this.left,this.startY=i-this.top,this.isDrag=!0,this.el.style.transition="",document.body.style.userSelect="none",this.options.forbidBodyScroll&&(document.body.style.overflow="hidden"),this.emitEvent("todragstart")},i.prototype.moveEvent=function(t){if(this.isDrag){var i,s;t.preventDefault();var e=this.isTouch?t.changedTouches[0].clientX:t.x,o=this.isTouch?t.changedTouches[0].clientY:t.y;if(this.options.isAbsolute){var n=this.parent.getClientRects()[0];i=e-n.x-this.startX,s=o-n.y-this.startY}else i=e-this.startX,s=o-this.startY;this.left=this.setBetween(i,0,this.maxX),this.top=this.setBetween(s,0,this.maxY),this.el.style.left=this.left+"px",this.el.style.top=this.top+"px",this.emitEvent("todragmove")}},i.prototype.endEvent=function(){this.isDrag=!1,document.removeEventListener("mousemove",this.moveEvent),document.removeEventListener("mouseup",this.endEvent),document.removeEventListener("touchmove",this.moveEvent),document.removeEventListener("touchend",this.endEvent),document.body.style.userSelect="auto",this.options.forbidBodyScroll&&(document.body.style.overflow="visible"),this.handleAdsorb(),this.handlePositionMode(),this.emitEvent("todragend")},i.prototype.handleAdsorb=function(){if(!this.options.isAbsolute){var t=[this.left+this.width/2,this.top+this.height/2],i=[window.innerWidth,window.innerHeight];if(this.el.style.transition="left "+this.options.transitionDuration+"s "+this.options.transitionTimingFunction+", \n                                top "+this.options.transitionDuration+"s "+this.options.transitionTimingFunction,1===this.options.adsorb)t[0]<=window.innerWidth/2?this.left=this.options.adsorbOffset:this.left=this.maxX-this.options.adsorbOffset;else if(2===this.options.adsorb){var s=i[1]/i[0],e=i[1]/-i[0],o=t[1]/t[0],n=t[1]/(t[0]-i[0]);s>=o&&e<n?this.top=this.options.adsorbOffset:s>=o&&e>=n?this.left=this.maxX-this.options.adsorbOffset:s<o&&e>=n?this.top=this.maxY-this.options.adsorbOffset:this.left=this.options.adsorbOffset,this.options.adsorbOffset&&(0===this.top&&(this.top=this.options.adsorbOffset),this.top===this.maxY&&(this.top=this.maxY-this.options.adsorbOffset),0===this.left&&(this.left=this.options.adsorbOffset),this.left===this.maxX&&(this.left=this.maxX-this.options.adsorbOffset))}this.el.style.left=this.left+"px",this.el.style.top=this.top+"px"}},i.prototype.handlePositionMode=function(){this.options.adsorb||(this.right=this.maxX-this.left,this.bottom=this.maxY-this.top,2===this.options.positionMode?(this.el.style.left="auto",this.el.style.right=this.right+"px"):3===this.options.positionMode?(this.el.style.top="auto",this.el.style.bottom=this.bottom+"px"):4===this.options.positionMode&&(this.el.style.left="auto",this.el.style.top="auto",this.el.style.right=this.right+"px",this.el.style.bottom=this.bottom+"px"))},i.prototype.emitEvent=function(t){var i=document.createEvent("HTMLEvents");i.initEvent(t,!1,!1);var s=this,e=s.left,o=s.top,n=s.right,h=s.bottom,r=s.width,d=s.height,a=s.maxX,l=s.maxY;i.left=e,i.top=o,i.width=r,i.height=d,i.maxX=a,i.maxY=l,i.right=n,i.bottom=h,this.el.dispatchEvent(i)},i.prototype.destroy=function(){this.isTouch?this.el.removeEventListener("touchstart",this.handleTouchStart):this.el.removeEventListener("mousedown",this.handleMousedown)},i}(),s=function(s,e,o){var n=e.value,h=t(t({},o||{}),n);s.$toDarg=new i({el:s,options:h})},e=function(t){t.$toDarg&&t.$toDarg.destroy()},o={install:function(t,i){t.directive("to-drag",{mounted:function(t,e){return s(t,e,i)},unmounted:e,inserted:function(t,e){return s(t,e,i)},unbind:e})},mounted:function(t,i){return s(t,i)},unmounted:e,inserted:function(t,i){return s(t,i)},unbind:e};export{o as T};
